# 设计文档

## 项目概述

Genie（灯神）是一个NoApp平台，它支持真正意义上的“自然语言端到端编程”，
用户只需输入一句话，就可以生成一个完整的、带有UI的应用程序。

## 实现方式

### 后端（一句话生成App是怎么实现的？）

为了实现一句话生成App的功能，我们对App本身进行了限制。
是的，不是什么App都能生成，必须是“函数式”的App，将输入数据变换为输出数据。

我们定义了一套serialization协议，输入可以是文件、字符串、数据等等（可以是一个不限深度的树状结构）；输出也是同理。
然后将这套协议映射到了Python的Type Annotation和Dart的类型中。

经过这些抽象，我们实现了App和函数之间的映射关系。
服务器接到用户的一句话后，会生成一个Python脚本，这个脚本就是App的实现。
然后，我们有一个类似parser的东西会机械式的将Python脚本里的函数声明提取出来，
根据这个声明生成符合我们serialization协议的“接口定义”，
并提取脚本里使用的包，把这个Python脚本打包成一个docker镜像，
这个docker镜像就是App的“后端”。

当然，还有其他一些实现细节，尤其是文件输入和输出的处理，
偏工程，这里就不赘述了。

### 前端（小程序UI的生成是怎么实现的？）

其实很简单，没有什么“动态前端代码生成”，
客户端接收到App的接口定义后，会机械化地根据输入输出类型（以及field name）及其他的一些数据（比如App标题和描述），
递归生成一个Widget Tree。

### 其他

还有一些比较常规的细节，比如：

- App市场与检索：用户生成的App在App市场里可见，检索的方式就是简单的向量数据库检索，
每个App的描述和用户输入的一句话都会被转换成向量，然后计算余弦相似度。
- 部署：没有做serverless和集群适配，后端是部署在自己电脑上，然后租了一个带公网IP的服务器，
通过SSH反向代理达到了可以从公网访问服务的效果。
